#include "cordiccart2pol.h"
#include <stdio.h>
data_t shift[NO_ITER] = {1, 0.500000000000000, 0.250000000000000, 0.125000000000000, 0.0625000000000000, 0.0312500000000000, 0.0156250000000000, 0.00781250000000000, 0.00390625000000000, 0.00195312500000000, 0.000976562500000000, 0.000488281250000000, 0.000244140625000000, 0.000122070312500000, 6.10351562500000e-05, 3.05175781250000e-05};
//data_t Kvalues[NO_ITER] = {0.70710678118655, 0.63245553203368, 0.61357199107790, 0.60883391251775, 0.60764825625617, 0.60735177014130, 0.60727764409353, 0.60725911229889, 0.60725447933256, 0.60725332108988, 0.60725303152913, 0.60725295913894, 0.60725294104140, 0.60725293651701, 0.60725293538591, 0.60725293510314};
data_t angles[NO_ITER] = {0.785398163397448, 0.463647609000806, 0.244978663126864, 0.124354994546761, 0.0624188099959574, 0.0312398334302683, 0.0156237286204768, 0.00781234106010111, 0.00390623013196697, 0.00195312251647882, 0.000976562189559320, 0.000488281211194898, 0.000244140620149362, 0.000122070311893670, 6.10351561742088e-05, 3.05175781155261e-05};

void cordiccart2pol(data_t x, data_t y, data_t *r, data_t *theta)
{
	// Write your code here
	unsigned char i;
	float x_old;

	*theta = 0.0;

Preprocessing:
	if (x < 0)
	{
		x_old = x;

		if (y < 0)
		{
			x = -y;
			y = x_old;
			*theta = -1.57079632;
		}
		else
		{
			x = y;
			y = -x_old;
			*theta = 1.57079632;
		}
	}

Rotation:
	for (i = 0; i < ITER_RUN; i++)
	{
		x_old = x;

		if (y > 0)
		{
			x += y * shift[i];
			y -= x_old * shift[i];
			*theta += angles[i];
		}
		else
		{
			x -= y * shift[i];
			y += x_old * shift[i];
			*theta -= angles[i];
		}
	}

	*r = x * 0.60725293510314;
}
